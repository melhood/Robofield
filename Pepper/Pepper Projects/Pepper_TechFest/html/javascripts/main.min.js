window.addEventListener("error",handleError,!0);var memory_service=void 0,speech_service=void 0,survey_service=void 0;function handleError(e){e.message?alert("error: "+e.message+" at linenumber: "+e.lineno+" of file: "+e.filename):alert("error: "+e.type+" from element: "+(e.srcElement||e.target))}function fadeOut(e){e.style.opacity=1,function t(){(e.style.opacity-=.1)<0?(e.style.display="none",e.classList.add("is-hidden")):requestAnimationFrame(t)}()}function fadeIn(e,t){e.classList.contains("is-hidden")&&e.classList.remove("is-hidden"),e.style.opacity=0,e.style.display=t||"inline",function t(){var n=parseFloat(e.style.opacity);(n+=.1)>1||(e.style.opacity=n,requestAnimationFrame(t))}()}function daydiff(e,t){return Math.round((e-t)/864e5)}function grade(e){if(!e.dataset.gradingDepends||document.getElementById(e.dataset.gradingDepends).checked){var t=e.dataset.grading;return"sum"==t?summed(e):"q_score"==t?q_score(e):void 0}}function summed(e){var t=document.getElementsByName(e.dataset.gradingTo)[0],n=e.getElementsByClassName("graded"),i=0;for(idx=0;idx<n.length;idx++){var s=n[idx];"radio"==s.type||"checkbox"==s.type?i+=s.checked?parseInt(s.value):0:i+=parseInt(s.value)}t.value=i}function q_score(e){var t=document.getElementsByName(e.dataset.gradingTo)[0],n=e.getElementsByClassName("q1"),i=e.getElementsByClassName("q2"),s=e.getElementsByClassName("d1"),a=e.getElementsByClassName("d2"),r=e.getElementsByClassName("d3");if(0!=n.length)if(0!=i.length)if(0!=s.length)if(0!=a.length)if(0!=r.length){n=parseInt(n[0].value),i=parseInt(i[0].value),s=s[0].valueAsDate,a=a[0].valueAsDate,r=r[0].valueAsDate;var o=daydiff(s,a),l=daydiff(a,r);q=(n+i)/(o+l),t.value=q}else console.error("Unable to located field: d3");else console.error("Unable to located field: d2");else console.error("Unable to located field: d1");else console.error("Unable to located field: q2");else console.error("Unable to located field: q1")}var timeoutId=void 0;function reportValidity(e,t){t=t||"There are unanswered questions";var n=document.getElementById("invalid-popup");document.getElementById("invalid-message").innerHTML=t,n&&(timeoutId?(clearTimeout(timeoutId),timeoutId=void 0):fadeIn(n),timeoutId=setTimeout(function(){fadeOut(n),timeoutId=void 0},2e3))}function validateFields(e){var t=e.querySelectorAll("input, select"),n=new Set,i=[];if(0==t.length)return!0;for(idx=0;idx<t.length;idx++)n.add(t[idx].name);return n.forEach(function(e){i.push(e)}),Array.from(i).every(function(t){var n=document.querySelectorAll('*[name="'+t+'"]'),i=void 0,s=!1;for(idx=0;idx<n.length;idx++){var a=n[idx];"radio"==a.type||"checkbox"==a.type?s=s||a.checked:"number"==a.type?a.value.length>0&&(parseInt(a.value)>parseInt(a.max)||parseInt(a.value)<parseInt(a.min))?i=0==a.max.length?"Response must be greater than or equal to "+a.min:0==a.min.length?"Response must be less than or equal to "+a.max:"Response must be between "+a.min+" and "+a.max:s=a.value.length>0:s=s||a.value.length>0}return s||0==n.length||reportValidity(e,i),s})}function toJSONString(e){for(var t={},n=e.querySelectorAll("input, select, textarea"),i=0;i<n.length;++i){var s=n[i],a=s.name,r=s.value;if("radio"==s.type||"checkbox"==s.type){if(!s.checked)continue}else if(0==s.value.length)continue;objectMerge(t,serializeInput(a,r))}return JSON.stringify(t)}function serializeInput(e,t){var n=e.match(/\[[^\]]*]/g);for(n?n.unshift("["+e.substring(0,e.indexOf("["))+"]"):n=["["+e+"]"],i=n.length;i>0;i--){var s=n[i-1].substr(1,n[i-1].length-2);0==s.length?t=[t]:(tmp=t,(t={})[s]=tmp)}return t}function objectMerge(e,t){for(var n in t)Array.isArray(t[n])?(n in e||(e[n]=[]),e[n]=e[n].concat(t[n])):(t[n],n in e?objectMerge(e[n],t[n]):e[n]=t[n])}function connected(e){e&&(e.service("ALMemory").then(function(e){memory_service=e;var t=document.querySelectorAll("[data-transition-event]");for(idx=0;idx<t.length&&memory_service;idx++)!function(){var e=t[idx];0!=e.dataset.transitionEvent.length&&memory_service.subscriber(e.dataset.transitionEvent).then(function(t){t.signal.connect(function(t){e.getElementsByClassName("btn-navigate")[0].click()})})}()}),e.service("ALTextToSpeech").then(function(e){e.setParameter("speed",80),speech_service=e}),e.service("SurveyService").then(function(e){survey_service=e}))}function disconnected(){console.log("Disconnected...")}var elements=document.getElementsByClassName("btn-navigate");for(idx=0;idx<elements.length;idx++)elements[idx].onclick=function(){var e=this.closest(".survey-box"),t=document.getElementById(this.dataset.depends),n=void 0==t||t.checked?this.dataset.next:this.dataset.fallthrough,i=document.getElementById(n);if(void 0!=i&&(this.classList.contains("previous")||validateFields(e))){this.dataset.triggerEvent&&memory_service&&memory_service.raiseEvent(this.dataset.triggerEvent,1);var s=this.closest(".survey-group"),a=i.closest(".survey-group");if(s!=a&&(a.style.display="block",s.style.display="none",s.dataset.grading&&grade(s)),e.style.display="none",i.style.display="block",speech_service&&!this.classList.contains("previous")){var r=i.getElementsByTagName("h1")[0];r&&speech_service.say(r.innerText)}if(!memory_service&&i.dataset.transitionEvent)i.getElementsByClassName("btn-navigate")[0].click();var o=document.getElementsByClassName("survey-box"),l=(Array.from(o).indexOf(i)+1)/o.length*100;document.getElementById("progress-bar").style.width=l+"vw"}};elements=document.getElementsByClassName("btn-reset");for(idx=0;idx<elements.length;idx++)elements[idx].onclick=function(){location.reload()};elements=document.getElementsByClassName("btn-submit");for(idx=0;idx<elements.length;idx++)elements[idx].onclick=function(){this.onclick=function(){return!1};var e=JSON.parse(toJSONString(this.form));return"end"!=this.closest(".survey-box").id&&(e.exit=this.closest(".survey-box").id),survey_service.save(JSON.stringify(e)).then(function(e){location.reload()}),!1};elements=document.getElementsByTagName("form");for(idx=0;idx<elements.length;idx++)elements[idx].onkeypress=function(e){return 13!=e.keyCode};try{QiSession(function(e){connected(e)},disconnected)}catch(e){console.error(e)}
